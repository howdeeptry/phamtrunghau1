<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Công cụ Quy đổi HPU2</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for Inter font and rounded corners */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #fef2f2; /* Light red background */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            background-color: #ffffff;
            padding: 32px;
            border-radius: 16px; /* Rounded corners for the main container */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            max-width: 500px;
            width: 100%;
        }
        h1 {
            color: #b91c1c; /* Dark red text */
        }
        .input-group label {
            font-weight: 600;
            color: #b91c1c; /* Dark red text */
            margin-bottom: 8px;
            display: block;
        }
        .input-group input,
        .input-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ef4444; /* Red border */
            border-radius: 8px; /* Rounded corners for inputs/selects */
            font-size: 16px;
            color: #475569;
            box-sizing: border-box; /* Ensures padding doesn't affect total width */
        }
        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: #dc2626; /* Red focus border */
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.2); /* Red shadow on focus */
        }
        .button-primary {
            background-color: #dc2626; /* Red button */
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px; /* Rounded corners for button */
            cursor: pointer;
            font-size: 18px;
            font-weight: 600;
            transition: background-color 0.3s ease;
            width: 100%;
        }
        .button-primary:hover {
            background-color: #b91c1c; /* Darker red on hover */
        }
        .result-box {
            background-color: #fee2e2; /* Lighter red background for result */
            border-left: 5px solid #dc2626; /* Red border */
            padding: 16px;
            border-radius: 8px; /* Rounded corners for result box */
            margin-top: 24px;
            font-size: 1.15em;
            font-weight: 600;
            color: #b91c1c; /* Dark red text */
        }
        .warning-message {
            color: #ef4444; /* Red warning text */
            font-size: 0.9em;
            margin-top: 16px;
            text-align: center;
        }
        .disabled-option {
            color: #94a3b8;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-3xl font-bold text-center mb-2 text-red-700">Công cụ Quy đổi HPU2</h1>
        <p class="text-center text-gray-600 mb-8">Made by HowdeepTry</p>

        <div class="mb-6 input-group">
            <label for="input_type">Chọn phương thức đầu vào:</label>
            <select id="input_type" name="input_type" required class="rounded-lg">
                <option value="hoc_ba">Học bạ</option>
                <option value="spt">SPT</option>
                <option value="hsa">HSA</option>
                <option value="ktdl">Kì thi độc lập (HPU2)</option>
            </select>
        </div>

        <div class="mb-6 input-group">
            <label for="block">Chọn khối:</label>
            <select id="block" name="block" required class="rounded-lg">
                <option value="A00">A00</option>
                <option value="B00">B00</option>
                <option value="C00">C00</option>
                <option value="D01">D01</option>
            </select>
        </div>

        <div class="mb-6 input-group">
            <label for="score" id="score_label">Điểm đầu vào:</label>
            <input type="text" id="score" name="score" placeholder="Ví dụ: 29.5" required class="rounded-lg">
        </div>

        <div class="mb-8 input-group">
            <label for="priority_area">Chọn khu vực ưu tiên:</label>
            <select id="priority_area" name="priority_area" required class="rounded-lg">
                <option value="none">Không ưu tiên</option>
                <option value="kv1">Khu vực 1 (+0.75 điểm)</option>
                <option value="kv2_nong_thon">Khu vực 2 nông thôn (+0.5 điểm)</option>
                <option value="kv2">Khu vực 2 (+0.25 điểm)</option>
            </select>
        </div>

        <button onclick="performConversion()" class="button-primary rounded-lg">Quy đổi</button>

        <div id="result" class="result-box hidden">
            <!-- Kết quả sẽ hiển thị ở đây -->
        </div>

        <div class="warning-message">
            *Lưu ý: Điểm ưu tiên được tính theo công thức mới.
        </div>
    </div>

    <script>
        // Dữ liệu quy đổi từ các phương thức đầu vào sang điểm THPT (thang 30)
        // Cấu trúc: CONVERSION_DATA[input_type][block_type] = [{a, b, c, d}, ...]
        // a, b: khoảng điểm của phương thức đầu vào (input)
        // c, d: khoảng điểm của phương thức đầu ra (output - THPT thang 30)
        const CONVERSION_DATA = {
            'hoc_ba': { // Học bạ -> THPT
                label: "Điểm Học bạ (thang 30):",
                outputLabel: "Điểm THPT tương ứng (thang 30):",
                'A00': [
                    { a: 29, b: 30, c: 25, d: 30 },
                    { a: 24, b: 29, c: 20, d: 25 },
                    { a: 19, b: 24, c: 15, d: 20 }
                ],
                'B00': [
                    { a: 25, b: 30, c: 25, d: 30 },
                    { a: 20, b: 25, c: 20, d: 25 }
                ],
                'C00': [
                    { a: 27, b: 30, c: 27, d: 30 },
                    { a: 22, b: 27, c: 22, d: 27 },
                    { a: 17, b: 22, c: 17, d: 22 }
                ],
                'D01': [
                    { a: 29, b: 30, c: 29, d: 30 },
                    { a: 24, b: 29, c: 24, d: 29 },
                    { a: 19, b: 24, c: 19, d: 24 }
                ]
            },
            'spt': { // SPT -> THPT
                label: "Điểm SPT (thang 30):",
                outputLabel: "Điểm THPT tương ứng (thang 30):",
                'A00': [
                    { a: 25.00, b: 30.00, c: 28.50, d: 30.00 },
                    { a: 20.00, b: 25.00, c: 26.15, d: 28.50 },
                    { a: 15.00, b: 20.00, c: 22.15, d: 26.15 },
                    { a: 9.00, b: 15.00, c: 15.00, d: 22.15 }
                ],
                'B00': [
                    { a: 25.00, b: 30.00, c: 28.40, d: 30.00 },
                    { a: 20.00, b: 25.00, c: 25.15, d: 28.40 },
                    { a: 15.00, b: 20.00, c: 21.00, d: 25.15 },
                    { a: 9.00, b: 15.00, c: 14.00, d: 21.00 }
                ],
                'C00': [
                    { a: 25.00, b: 30.00, c: 29.00, d: 30.00 },
                    { a: 20.00, b: 25.00, c: 26.80, d: 29.00 },
                    { a: 15.00, b: 20.00, c: 23.50, d: 26.80 },
                    { a: 9.00, b: 15.00, c: 14.00, d: 23.50 }
                ],
                'D01': [
                    { a: 25.00, b: 30.00, c: 27.40, d: 30.00 },
                    { a: 20.00, b: 25.00, c: 24.25, d: 27.40 },
                    { a: 15.00, b: 20.00, c: 20.50, d: 24.25 },
                    { a: 9.00, b: 15.00, c: 15.00, d: 20.50 }
                ]
            },
            'hsa': { // HSA -> THPT
                label: "Điểm HSA (thang 150):",
                outputLabel: "Điểm THPT tương ứng (thang 30):",
                'A00': [
                    { a: 120, b: 150, c: 29.50, d: 30 },
                    { a: 100, b: 120, c: 27.25, d: 29.50 },
                    { a: 75, b: 100, c: 21.85, d: 27.25 },
                    { a: 40, b: 75, c: 10.70, d: 21.85 }
                ],
                'B00': [
                    { a: 120, b: 150, c: 29.00, d: 30 },
                    { a: 100, b: 120, c: 26.50, d: 29.00 },
                    { a: 75, b: 100, c: 20.75, d: 26.50 },
                    { a: 40, b: 75, c: 10.00, d: 20.75 }
                ],
                'C00': [
                    { a: 120, b: 150, c: 29.05, d: 30 },
                    { a: 100, b: 120, c: 27.75, d: 29.05 },
                    { a: 75, b: 100, c: 24.50, d: 27.75 },
                    { a: 40, b: 75, c: 14.75, d: 24.50 }
                ],
                'D01': [
                    { a: 120, b: 150, c: 27.05, d: 30 },
                    { a: 100, b: 120, c: 24.25, d: 27.05 },
                    { a: 75, b: 100, c: 20.25, d: 24.25 },
                    { a: 40, b: 75, c: 12.60, d: 20.25 }
                ]
            },
            'ktdl': { // Kì thi độc lập (HPU2) -> THPT
                label: "Điểm Kì thi độc lập (HPU2 - thang 100):",
                outputLabel: "Điểm THPT tương ứng (thang 30):",
                'A00': [
                    { a: 29.60, b: 30, c: 29.00, d: 30 },
                    { a: 27.05, b: 29.60, c: 25.00, d: 29.00 },
                    { a: 16.60, b: 27.05, c: 15.00, d: 25.25 }
                ],
                'B00': [
                    { a: 28.95, b: 30, c: 28.25, d: 30 },
                    { a: 23.40, b: 28.95, c: 21.00, d: 28.25 },
                    { a: 17.00, b: 23.40, c: 15.00, d: 21.00 }
                ],
                'C00': [
                    { a: 28.90, b: 30, c: 29.25, d: 30 },
                    { a: 25.10, b: 28.90, c: 26.50, d: 29.25 },
                    { a: 19.95, b: 25.10, c: 22.20, d: 26.50 },
                    { a: 12.70, b: 19.95, c: 15.00, d: 22.20 }
                ],
                'D01': [
                    { a: 28.05, b: 30, c: 27.00, d: 30 },
                    { a: 26.65, b: 28.05, c: 24.50, d: 27.00 },
                    { a: 14.50, b: 26.65, c: 15.00, d: 24.50 }
                ]
            }
        };

        // Mức điểm ưu tiên cơ bản theo khu vực
        const PRIORITY_POINTS = {
            'none': 0,
            'kv1': 0.75,
            'kv2_nong_thon': 0.5,
            'kv2': 0.25
        };

        function calculateConversion(x, inputType, block) {
            /**
             * Tính điểm quy đổi từ điểm đầu vào (x) sang điểm THPT (thang 30)
             * dựa trên công thức y = c + ((x-a)/(b-a)) * (d-c)
             */
            if (CONVERSION_DATA[inputType] && CONVERSION_DATA[inputType][block]) {
                const ranges = CONVERSION_DATA[inputType][block];
                for (const { a, b, c, d } of ranges) {
                    // Check if x is within the range [a, b]
                    // Or if x is exactly the upper bound of the last range (to handle max values)
                    // Added a small epsilon to handle floating point comparisons for ranges like [29, 30]
                    const epsilon = 0.0001;
                    if ((x >= a - epsilon && x <= b + epsilon) || (x > b && a === Math.max(...ranges.map(r => r.a)))) {
                        if (Math.abs(b - a) < epsilon) { // Avoid division by zero if range is a single point or very small
                            return c;
                        }
                        // Apply the conversion formula: y = c + ((x-a)/(b-a)) * (d-c)
                        const y = c + ((x - a) / (b - a)) * (d - c);
                        return Math.round(y * 1000) / 1000; // Round to 3 decimal places
                    }
                }
                return "Không tìm thấy khoảng điểm phù hợp.";
            } else {
                return "Phương thức quy đổi hoặc khối không được hỗ trợ.";
            }
        }

        function calculatePriorityScore(convertedScore, priorityArea) {
            const basePriorityPoints = PRIORITY_POINTS[priorityArea];
            if (basePriorityPoints === undefined || basePriorityPoints === 0) {
                return 0; // No priority or invalid area
            }

            // Apply the priority score formula if convertedScore is 22.5 or higher (on a 30-point scale)
            if (convertedScore >= 22.5) {
                let calculatedPriority = ((30 - convertedScore) / 7.5) * basePriorityPoints;
                // Ensure priority score is not negative and capped at basePriorityPoints
                return Math.max(0, Math.min(basePriorityPoints, Math.round(calculatedPriority * 1000) / 1000));
            } else {
                return basePriorityPoints; // Full priority points apply if score is below 22.5
            }
        }

        function performConversion() {
            const scoreInput = document.getElementById('score');
            const inputTypeSelect = document.getElementById('input_type');
            const blockSelect = document.getElementById('block');
            const priorityAreaSelect = document.getElementById('priority_area');
            const resultDiv = document.getElementById('result');

            let score = parseFloat(scoreInput.value);
            const inputType = inputTypeSelect.value;
            const block = blockSelect.value;
            const priorityArea = priorityAreaSelect.value;

            // Hide old results
            resultDiv.classList.add('hidden');
            resultDiv.innerHTML = ''; // Clear previous content

            if (isNaN(score)) {
                resultDiv.innerHTML = "Vui lòng nhập một số hợp lệ cho điểm.";
                resultDiv.classList.remove('hidden');
                return;
            }

            const convertedScore = calculateConversion(score, inputType, block);

            if (typeof convertedScore !== 'number') { // Check if conversion was successful (returned a number)
                resultDiv.innerHTML = `Điểm quy đổi ban đầu: ${convertedScore}`; // Display error message from conversion
                resultDiv.classList.remove('hidden');
                return;
            }

            const priorityScore = calculatePriorityScore(convertedScore, priorityArea);
            const finalTotalScore = convertedScore + priorityScore;

            const outputLabel = CONVERSION_DATA[inputType].outputLabel;

            let resultHtml = `
                <p>${outputLabel} <strong>${convertedScore}</strong></p>
            `;

            if (priorityArea !== 'none') {
                resultHtml += `
                    <p>Điểm ưu tiên (${priorityArea.toUpperCase()}): <strong>${priorityScore}</strong></p>
                    <p>Tổng điểm sau ưu tiên: <strong>${Math.round(finalTotalScore * 1000) / 1000}</strong></p>
                `;
            }

            resultDiv.innerHTML = resultHtml;
            resultDiv.classList.remove('hidden');
        }

        // Update input score label and placeholder when input type or block changes
        function updateInputFields() {
            const selectedType = document.getElementById('input_type').value;
            const scoreLabel = document.getElementById('score_label');
            const scoreInput = document.getElementById('score');

            scoreLabel.textContent = CONVERSION_DATA[selectedType].label;

            // Set placeholder based on input type
            if (selectedType === 'hsa') {
                scoreInput.placeholder = "Ví dụ: 98 (thang 150)";
            } else if (selectedType === 'ktdl') {
                scoreInput.placeholder = "Ví dụ: 80 (thang 100)";
            } else { // hoc_ba, spt
                scoreInput.placeholder = "Ví dụ: 29.5 (thang 30)";
            }
        }

        document.getElementById('input_type').addEventListener('change', updateInputFields);
        document.getElementById('block').addEventListener('change', updateInputFields); // Also update on block change

        // Initialize label and placeholder on page load
        document.addEventListener('DOMContentLoaded', updateInputFields);
    </script>
</body>
</html>

